<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to the Currency Converter Codica</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <svg width="100%" height="100%" viewBox="0 0 100 4" xmlns="http://www.w3.org/2000/svg"></svg>
    <h1>Welcome to the Currency Converter Codica</h1>

    <div class="flex-container">
        <div class="container">
            <form id="currencyForm1" action="/list_all_currencies" method="GET">
                <h2>List All Currencies</h2>
                <button type="submit">List All</button>
            </form>
            <div id="currenciesTable"></div>
            <button type="reset" id="resetButton1" style="display: none;">Reset</button>
        </div>
    </div>

    <div class="flex-container">
        <div class="container">
            <form id="currencyForm2" action="/get_exchange_rate" method="GET">
                <h2>Exchange Rate</h2>
                <label for="target_currency">The base currency is USD. If you need a different base currency, enter it below; otherwise, leave the field blank.</label>
                <input type="text" id="target_currency" name="target_currency" placeholder="e.g., USD, EUR, GBP">
                <button type="submit">Submit</button>
            </form>
            <div id="exchanges"></div>
            <button type="reset" id="resetButton2" style="display: none;">Reset</button>
        </div>
    </div>

    <div class="flex-container">
        <div class="container">
            <form id="currencyForm3" action="/custom_exchange_rate" method="GET">
                <h2>Custom Exchange Rate</h2>
                <label for="custom_currency">The base currency is USD. If you need a different base currency, enter it below; otherwise, leave the field blank.</label>
                <input type="text" id="custom_currency" name="custom_currency" placeholder="e.g., USD, EUR, GBP">
                <label for="target_custom_currency">Enter the target currency code, if more than one separate it by comma</label>
                <input type="text" id="target_custom_currency" name="target_custom_currency" placeholder="e.g., USD, EUR, GBP" required>
                <button type="submit">Submit</button>
            </form>
            <div id="custom_exchanges"></div>
            <button type="reset" id="resetButton3" style="display: none;">Reset</button>
        </div>
    </div>

    <div class="flex-container">
        <div class="container">
            <form id="currencyForm4" action="/exchange_value" method="GET">
                <h2>Exchange Value</h2>
                <label for="amount">Enter the amount to exchange.</label>
                <input type="number" id="amount" name="amount" required>
                <label for="custom_currency_exchange">The base currency is USD. If you need a different base currency, enter it below; otherwise, leave the field blank.</label>
                <input type="text" id="custom_currency_exchange" name="custom_currency_exchange" placeholder="e.g., USD, EUR, GBP">
                <label for="target_custom_currency_exchange">Enter the target currency code</label>
                <input type="text" id="target_custom_currency_exchange" name="target_custom_currency_exchange" placeholder="e.g., USD" maxlength="3" required>
                <button type="submit">Submit</button>
            </form>
            <div id="exchanges_value"></div>
            <button type="reset" id="resetButton4" style="display: none;">Reset</button>
        </div>
    </div>

    <div class="flex-container">
        <div class="container">
            <form id="currencyForm5" action="/historical_log" method="GET">
                <h2>Historical Log</h2>
                <button type="submit">Search</button>
            </form>
            <div id="logs"></div>
            <button type="reset" id="resetButton5" style="display: none;">Reset</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const forms = [
                {
                    formId: 'currencyForm1',
                    resultId: 'currenciesTable',
                    resetButtonId: 'resetButton1',
                    url: '/list_all_currencies',
                    handleData: (data) => {
                        let tableHTML = '<h2>Currencies Information</h2><table><tr><th>Currency</th><th>Symbol</th><th>Name</th></tr>';
                        for (const currency in data.data) {
                            const { symbol, name } = data.data[currency];
                            tableHTML += `<tr><td>${currency}</td><td>${symbol}</td><td>${name}</td></tr>`;
                        }
                        return tableHTML + '</table>';
                    }
                },
                {
                    formId: 'currencyForm2',
                    resultId: 'exchanges',
                    resetButtonId: 'resetButton2',
                    url: () => `/get_exchange_rate?base_currency=${document.getElementById('target_currency').value.trim().toUpperCase() || 'USD'}`,
                    handleData: (data) => {
                        let exchangeHTML = '<h2>Exchange Rate Information</h2><table><tr><th>Currency</th><th>Exchange Rate</th></tr>';
                        for (const currency in data.exchangeRate.data) {
                            const rate = data.exchangeRate.data[currency];
                            exchangeHTML += `<tr><td>${currency}</td><td>${rate}</td></tr>`;
                        }
                        return exchangeHTML + '</table>';
                    }
                },
                {
                    formId: 'currencyForm3',
                    resultId: 'custom_exchanges',
                    resetButtonId: 'resetButton3',
                    url: () => {
                        const base = document.getElementById('custom_currency').value.trim().toUpperCase();
                        const target = document.getElementById('target_custom_currency').value.trim().toUpperCase().replace(/\s+/g, '');
                        if (!target) {
                            alert('Please enter at least one currency.');
                            return null;
                        }
                        return `/custom_exchange_rate?base_currency=${base}&target_currency=${target}`;
                    },
                    handleData: (data) => {
                        let exchangeHTML = '<h2>Custom Exchange Rate Information</h2><table><tr><th>Currency</th><th>Exchange Rate</th></tr>';
                        for (const currency in data.exchangeRate.data) {
                            const rate = data.exchangeRate.data[currency];
                            exchangeHTML += `<tr><td>${currency}</td><td>${rate}</td></tr>`;
                        }
                        return exchangeHTML + '</table>';
                    }
                },
                {
                    formId: 'currencyForm4',
                    resultId: 'exchanges_value',
                    resetButtonId: 'resetButton4',
                    url: () => {
                        const amount = document.getElementById('amount').value.trim();
                        const base = document.getElementById('custom_currency_exchange').value.trim().toUpperCase();
                        const target = document.getElementById('target_custom_currency_exchange').value.trim().toUpperCase().replace(/\s+/g, '');
                        if (!target || !base || !amount || isNaN(parseFloat(amount))) {
                            alert('Please enter valid input.');
                            return null;
                        }
                        return `/exchange_value?amount=${amount}&base_currency=${base}&target_currency=${target}`;
                    },
                    handleData: (data) => {
                        const { base_currency, target_currency, amount, exchange_rate, total } = data;
                        return `<h2>Exchange Rate Calculation</h2><table><tr><th>Base Currency</th><th>Target Currency</th><th>Amount</th><th>Exchange Rate</th><th>Total</th></tr><tr><td>${base_currency}</td><td>${target_currency}</td><td>${amount}</td><td>${exchange_rate}</td><td>${total}</td></tr></table>`;
                    }
                },
                {
                    formId: 'currencyForm5',
                    resultId: 'logs',
                    resetButtonId: 'resetButton5',
                    url: '/historical_log',
                    handleData: (data) => {
                        let tableHTML = '<h2>Historical Exchange Rate Log</h2><table><tr><th>Timestamp</th><th>Base Currency</th><th>Target Currency</th><th>Amount</th><th>Exchange Rate</th><th>Total</th></tr>';

                        for (const timestamp in data) {
                            if (data.hasOwnProperty(timestamp)) {
                                const logEntry = data[timestamp];
                                tableHTML += `<tr>
                                    <td>${timestamp}</td>
                                    <td>${logEntry.base_currency}</td>
                                    <td>${logEntry.target_currency}</td>
                                    <td>${logEntry.amount}</td>
                                    <td>${logEntry.exchange_rate}</td>
                                    <td>${logEntry.total}</td>
                                </tr>`;
                            }
                        }

                        return tableHTML + '</table>';
                    }
                }
            ];

            forms.forEach(({ formId, resultId, resetButtonId, url, handleData }) => {
                const form = document.getElementById(formId);
                const resultDiv = document.getElementById(resultId);
                const resetButton = document.getElementById(resetButtonId);

                form.addEventListener('submit', async (event) => {
                    event.preventDefault();

                    const endpoint = typeof url === 'function' ? url() : url;
                    if (!endpoint) return;

                    const response = await fetch(endpoint);
                    const data = await response.json();

                    resultDiv.innerHTML = handleData(data);
                    resultDiv.style.display = 'block';
                    resetButton.style.display = 'inline-block';
                });

                resetButton.addEventListener('click', () => {
                    resultDiv.style.display = 'none';
                    resultDiv.innerHTML = '';
                    resetButton.style.display = 'none';
                    form.reset();
                });
            });
        });
    </script>
</body>
</html>
